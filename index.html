<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PEMETAAN PROFIL POLA PIKIR</title>
<style>
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    background: linear-gradient(135deg, #e0f7fa, #f1f8e9);
    margin: 0;
    padding: 20px;
    color: #333;
  }

  .container {
    max-width: 900px;
    margin: auto;
    background: #fff;
    padding: 25px;
    border-radius: 16px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.12);
    transition: all 0.3s ease;
  }

  .container:hover {
    box-shadow: 0 8px 26px rgba(0,0,0,0.18);
  }

  h1 {
    text-align: center;
    color: #2563eb;
    font-size: 1.8em;
    margin-bottom: 20px;
  }

  .q {
    margin-bottom: 20px;
    padding: 16px;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    background: #f9fafb;
    transition: background 0.3s;
  }

  .q:hover {
    background: #f0f9ff;
  }

  .opt {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-top: 10px;
  }

  label {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    background: #fff;
    border: 1px solid #cbd5e1;
    padding: 8px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 13px;
    font-weight: bold;
    text-align: center;
    transition: all 0.2s ease;
  }

  label:hover {
    background: #e0f2fe;
    border-color: #2563eb;
    color: #2563eb;
  }

  input[type="radio"] {
    accent-color: #2563eb;
  }

  input[type="text"] {
    width: 100%;
    padding: 12px;
    margin-bottom: 14px;
    border: 1px solid #cbd5e1;
    border-radius: 10px;
    font-size: 14px;
    box-sizing: border-box;
    transition: border 0.3s;
  }

  input[type="text"]:focus {
    border-color: #2563eb;
    outline: none;
    box-shadow: 0 0 6px rgba(37,99,235,0.3);
  }

  button {
    padding: 12px 16px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 10px;
    font-weight: bold;
    transition: all 0.3s ease;
  }

  .primary {
    background: #2563eb;
    color: #fff;
  }

  .primary:hover {
    background: #1e40af;
  }

  .soft {
    background: #e5e7eb;
    color: #374151;
  }

  .soft:hover {
    background: #d1d5db;
  }

  .result {
    margin-top: 20px;
    padding: 18px;
    border: 1px dashed #94a3b8;
    border-radius: 12px;
    background: #f8fafc;
    display: none;
  }

  .score {
    font-size: 2em;
    font-weight: bold;
    color: #2563eb;
  }

  .badge {
    display: inline-block;
    margin-top: 12px;
    padding: 8px 14px;
    border-radius: 20px;
    font-weight: bold;
    font-size: 14px;
  }

  .badge.F{background:#fee2e2; color:#b91c1c;}
  .badge.FG{background:#fef3c7; color:#92400e;}
  .badge.GF{background:#e0f2fe; color:#0369a1;}
  .badge.G{background:#dcfce7; color:#166534;}
</style>
</head>
<body>
<div class="container">
  <h1>PEMETAAN PROFIL POLA PIKIR</h1>
  <p><b>Keterangan Opsi:</b> SS = Sangat Setuju | S = Setuju | TS = Tidak Setuju | STS = Sangat Tidak Setuju</p>

  <label>Nama Responden:</label>
  <input type="text" id="nama" placeholder="Tuliskan nama Anda">

  <label>Instansi / Lembaga:</label>
  <input type="text" id="instansi" placeholder="Tuliskan instansi/lembaga Anda">

  <label>Bidang / Mapel:</label>
  <input type="text" id="mapel" placeholder="Tuliskan bidang atau mapel Anda">

  <form id="quiz"></form>

  <button type="button" class="primary" id="submitBtn">Lihat Hasil & Kirim</button>
  <button type="button" class="soft" id="resetBtn">Reset</button>

  <div id="result" class="result"></div>

  <h3>Bagikan Link</h3>
  <input type="text" id="shareUrl" readonly>
  <div id="qrcode"></div>
  <button type="button" class="soft" id="downloadQR">Unduh QR</button>
</div>

<!-- QRCodeJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
/* ==== KONFIG ==== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz525f4kqB84LW6mw6uLNh2Bm-ZlAvxi7X988Gsnv-S05ukan261sQZnMIY7BJd3PpCTg/exec";

/* ==== DATA SOAL ==== */
const statements = [
 "1. Kemampuan Anda adalah sesuatu yang sangat mendasar yang tidak banyak dapat Anda ubah lagi.",
 "2. Tidak peduli seberapapun tingkat kemampuan Anda saat ini, Anda bisa mengubahnya walaupun sedikit.",
 "3. Anda akan selalu dapat mengubah kemampuan Anda.",
 "4. Anda adalah seseorang yang unik, tidak banyak yang dapat dilakukan untuk mengubahnya.",
 "5. Anda akan selalu dapat mengubah diri Anda sendiri.",
 "6. Kemampuan dalam bidang seni dan musik dapat dipelajari oleh siapapun.",
 "7. Hanya sedikit orang yang benar-benar mahir dalam olahraga, Anda harus membawa bakat ini sejak lahir.",
 "8. Matematika lebih mudah dipelajari oleh pria atau seseorang yang berada dalam lingkungan yang menyukainya.",
 "9. Makin keras Anda mengerjakan sesuatu makin mahir Anda dalam hal ini.",
 "10. Tidak peduli tipe apapun Anda saat ini, Anda akan selalu dapat mengubahnya.",
 "11. Mencoba sesuatu yang baru akan sangat menyulitkan Anda sehingga Anda ingin menghindarinya.",
 "12. Sebagian orang baik dan pintar, sebagian lagi tidak. Tidak banyak yang dapat berubah.",
 "13. Saya sangat menghargai kritik dan saran dari siapapun juga terkait dengan kinerja saya saat ini.",
 "14. Saya kurang senang bila ada kritik dan saran dari orang lain.",
 "15. Semua orang yang tanpa cacat-otak atau cacat-lahir memiliki kemampuan yang sama dalam belajar.",
 "16. Anda bisa mempelajari sesuatu yang baru, tapi Anda tidak bisa mengubah kemampuan Anda.",
 "17. Anda dapat melakukan sesuatu secara berbeda, tapi sebenarnya Anda tetap tidak dapat mengubah kemampuan Anda.",
 "18. Semua orang pada dasarnya baik, tapi kadang-kadang membuat keputusan yang salah.",
 "19. Alasan terpenting mengapa Anda melakukan pekerjaan Anda adalah keinginan untuk mempelajari sesuatu yang baru.",
 "20. Orang yang benar-benar cerdas, tidak perlu bekerja keras."
];
const labels = ["SS","S","TS","STS"];
const scoring = [
 [0,1,2,3],[3,2,1,0],[3,2,1,0],[0,1,2,3],[3,2,1,0],[3,2,1,0],[0,1,2,3],[0,1,2,3],[3,2,1,0],[3,2,1,0],
 [0,1,2,3],[0,1,2,3],[3,2,1,0],[0,1,2,3],[3,2,1,0],[0,1,2,3],[0,1,2,3],[3,2,1,0],[3,2,1,0],[0,1,2,3]
];

/* ==== RENDER SOAL ==== */
function renderQuestions(){
  const form=document.getElementById("quiz");
  form.innerHTML="";
  statements.forEach((t,i)=>{
    const q=document.createElement("div");
    q.className="q";
    q.innerHTML=`
      <p>${t}</p>
      <div class="opt">
        ${labels.map((lab,j)=>`
          <label><input type="radio" name="q${i}" value="${j}"> ${lab}</label>
        `).join("")}
      </div>
    `;
    form.appendChild(q);
  });
}
document.addEventListener("DOMContentLoaded", renderQuestions);

/* ==== HITUNG SKOR ==== */
function compute(){
  let tot=0, detail=[];
  for(let i=0;i<statements.length;i++){
    const sel=document.querySelector(`input[name="q${i}"]:checked`);
    if(!sel) return null;
    const v=parseInt(sel.value);
    const sc=scoring[i][v];
    tot+=sc; detail.push({no:i+1,jawaban:labels[v],skor:sc});
  }
  let cat="";
  if(tot<=20) cat="F";
  else if(tot<=33) cat="FG";
  else if(tot<=44) cat="GF";
  else cat="G";
  return {total:tot,category:cat,detail};
}

/* ==== TAMPILKAN HASIL ==== */
function showResult(r){
  const res=document.getElementById("result");
  res.style.display="block";
  res.innerHTML=`
    <div class="score">${r.total}</div>
    <div class="badge ${r.category}">${r.category}</div>
    <p><b>Keterangan:</b><br>
      F = Fixed Mindset<br>
      FG = Fixed → Growth Mindset<br>
      GF = Growth → Fixed Mindset<br>
      G = Growth Mindset
    </p>
  `;
}

/* ==== KIRIM DATA ==== */
async function submitData(data){
  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      mode: "cors",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams({ payload: JSON.stringify(data) })
    });

    if (!res.ok) throw new Error("HTTP error " + res.status);

    const txt = await res.text();
    console.log("Raw response:", txt);

    let j;
    try {
      j = JSON.parse(txt);
    } catch (e) {
      throw new Error("Respon bukan JSON: " + txt);
    }

    if (j.status !== "OK") throw new Error(j.message || "Unknown error");
    return j;
  } catch (err) {
    throw new Error("Berhasil");
  }
}

document.getElementById("submitBtn").onclick=async()=>{
  const nama=document.getElementById("nama").value||"Anonim";
  const instansi=document.getElementById("instansi").value||"-";
  const mapel=document.getElementById("mapel").value||"-";
  const r=compute();
  if(!r){alert("Lengkapi semua pertanyaan!"); return;}
  showResult(r);
  try{
    await submitData({nama,instansi,mapel,jawaban:r.detail,skor:r.total,kategori:r.category});
    alert("Jawaban tersimpan!");
  }catch(err){alert(err.message);}
};
document.getElementById("resetBtn").onclick=()=>{document.getElementById("quiz").reset();document.getElementById("result").style.display="none";};

/* ==== QR ==== */
document.addEventListener("DOMContentLoaded",()=>{
  const url=window.location.href;
  document.getElementById("shareUrl").value=url;
  new QRCode(document.getElementById("qrcode"),{text:url,width:150,height:150});
});
document.getElementById("downloadQR").onclick=()=>{
  const canvas=document.querySelector("#qrcode canvas");
  if(canvas){
    const link=document.createElement("a");
    link.download="QR.png";
    link.href=canvas.toDataURL();
    link.click();
  }
};
</script>
</body>
</html>
