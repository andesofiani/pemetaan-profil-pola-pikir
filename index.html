<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PEMETAAN PROFIL POLA PIKIR</title>
<style>
  body {font-family: Arial, sans-serif; background:#e6f0fa; margin:0; padding:20px;}
  .container {max-width:900px; margin:auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.15);}
  h1 {text-align:center; color:#2563eb;}

  .form-group {margin-bottom:15px;}
  .form-group label {display:block; font-weight:bold; margin-bottom:5px;}
  .form-group input {
    width:95%; padding:10px; border:1px solid #ccc; border-radius:6px;
    box-shadow:inset 1px 1px 3px #bbb; font-size:15px;
  }

  .q {margin-bottom:15px; padding:15px; border:1px solid #ddd; border-radius:8px; background:#f9fbff;}
  .opt {display:grid; grid-template-columns: repeat(4, 1fr); gap:6px; margin-top:8px;}
  .opt label {
    background:#f0f4ff; padding:6px; border-radius:8px; border:1px solid #ccc;
    cursor:pointer; box-shadow:0 4px #999; text-align:center;
    font-weight:bold; font-size:11px; transition:all 0.15s ease;
    display:flex; align-items:center; justify-content:center; gap:6px;
  }
  .opt label:active {transform:translateY(2px); box-shadow:0 2px #666;}
  .opt input[type=radio] {width:14px; height:14px; accent-color:#2563eb;}
  .opt input:checked + span {color:#2563eb; font-weight:bold; animation:bounce 0.2s;}
  @keyframes bounce {0%{transform:scale(1);} 50%{transform:scale(0.85);} 100%{transform:scale(1);}}

  button {display:inline-block; padding:10px 14px; border:none; border-radius:6px; cursor:pointer;
    margin:10px 5px; font-weight:bold; transition:all 0.2s ease; box-shadow:0 4px #999;}
  button:active {transform:translateY(2px); box-shadow:0 2px #666;}
  .primary {background:#2563eb; color:#fff;}
  .soft {background:#f0f0f0; color:#333;}

  .result {margin-top:20px; padding:15px; border:1px dashed #888; border-radius:8px; display:none; text-align:center;}
  .score {font-size:4em; font-weight:bold; font-family:"Georgia",serif; color:#2563eb; display:inline-block; margin-right:20px;}
  .badge {display:inline-block; font-size:2em; vertical-align:middle; font-weight:bold; padding:6px 20px; border-radius:10px;}
  .badge.F{background:#fee2e2;color:#b91c1c;}
  .badge.FG{background:#fef3c7;color:#92400e;}
  .badge.GF{background:#e0f2fe;color:#0369a1;}
  .badge.G{background:#dcfce7;color:#166534;}

  .share-section {text-align:center; margin-top:30px;}
  .share-section input {width:90%; margin-bottom:20px; padding:10px; text-align:center;}
  #qrcode {margin:20px 0;}
</style>
</head>
<body>
<div class="container">
  <h1>PEMETAAN PROFIL POLA PIKIR</h1>
  <p><b>Keterangan Opsi:</b> SS = Sangat Setuju | S = Setuju | TS = Tidak Setuju | STS = Sangat Tidak Setuju</p>

  <div class="form-group">
    <label>NAMA RESPONDEN:</label>
    <input type="text" id="nama" placeholder="Tuliskan nama Anda" required>
  </div>
  <div class="form-group">
    <label>INSTANSI / LEMBAGA:</label>
    <input type="text" id="instansi" placeholder="Tuliskan instansi/lembaga Anda">
  </div>
  <div class="form-group">
    <label>BIDANG / MAPEL:</label>
    <input type="text" id="mapel" placeholder="Tuliskan bidang atau mapel Anda">
  </div>

  <form id="quiz"></form>

  <div style="text-align:center;">
    <button type="button" class="primary" id="submitBtn">SUBMIT</button>
    <button type="button" class="soft" id="resetBtn">RESET</button>
    <button type="button" class="soft" id="analisisBtn">ANALISIS</button>
  </div>

  <div id="result" class="result"></div>

  <div class="share-section">
    <h3>Bagikan Link</h3>
    <input type="text" id="shareUrl" readonly>
    <div id="qrcode"></div>
    <button type="button" class="soft" id="downloadQR">Unduh QR</button>
  </div>
</div>

<!-- QRCode -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
/* ===================== CONFIG ===================== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbysp9p57Sw8fP8d5HlXOztahZPO_Tt2uKDMJFb6YWEk1ZlERrMobgUGHsom3G08zN_NYQ/exec"; // <--- Ganti dengan URL Web App GAS (Deploy → New deployment)
const SHEET_DATE_LOCALE_OFFSET_MIN = 0; // biarkan 0 (timestamp dibuat di server). Opsi jika ingin kirim offset klien.

/* ================== MASTER DATA =================== */
const statements=[
 "Kemampuan Anda adalah sesuatu yang sangat mendasar yang tidak banyak dapat Anda ubah lagi.",
 "Tidak peduli seberapapun tingkat kemampuan Anda saat ini, Anda bisa mengubahnya walaupun sedikit.",
 "Anda akan selalu dapat mengubah kemampuan Anda.",
 "Anda adalah seseorang yang unik, tidak banyak yang dapat dilakukan untuk mengubahnya.",
 "Anda akan selalu dapat mengubah diri Anda sendiri.",
 "Kemampuan dalam bidang seni dan musik dapat dipelajari oleh siapapun.",
 "Hanya sedikit orang yang benar-benar mahir dalam olahraga, Anda harus membawa bakat ini sejak lahir.",
 "Matematika lebih mudah dipelajari oleh pria atau seseorang yang berada dalam lingkungan yang menyukainya.",
 "Makin keras Anda mengerjakan sesuatu makin mahir Anda dalam hal ini.",
 "Tidak peduli tipe apapun Anda saat ini, Anda akan selalu dapat mengubahnya.",
 "Mencoba sesuatu yang baru akan sangat menyulitkan Anda sehingga Anda ingin menghindarinya.",
 "Sebagian orang baik dan pintar, sebagian lagi tidak. Tidak banyak yang dapat berubah.",
 "Saya sangat menghargai kritik dan saran dari siapapun juga terkait dengan kinerja saya saat ini.",
 "Saya kurang senang bila ada kritik dan saran dari orang lain.",
 "Semua orang yang tanpa cacat-otak atau cacat-lahir memiliki kemampuan yang sama dalam belajar.",
 "Anda bisa mempelajari sesuatu yang baru, tapi Anda tidak bisa mengubah kemampuan Anda.",
 "Anda dapat melakukan sesuatu secara berbeda, tapi sebenarnya Anda tetap tidak dapat mengubah kemampuan Anda.",
 "Semua orang pada dasarnya baik, tapi kadang-kadang membuat keputusan yang salah.",
 "Alasan terpenting mengapa Anda melakukan pekerjaan Anda adalah keinginan untuk mempelajari sesuatu yang baru.",
 "Orang yang benar-benar cerdas, tidak perlu bekerja keras."
];
const labels=["SS","S","TS","STS"];
const scoring=[
 [0,1,2,3],[3,2,1,0],[3,2,1,0],[0,1,2,3],[3,2,1,0],
 [3,2,1,0],[0,1,2,3],[0,1,2,3],[3,2,1,0],[3,2,1,0],
 [0,1,2,3],[0,1,2,3],[3,2,1,0],[0,1,2,3],[3,2,1,0],
 [0,1,2,3],[0,1,2,3],[3,2,1,0],[3,2,1,0],[0,1,2,3]
];

/* ============== RENDER & UTILITIES ============== */
function renderQuestions(){
  const form=document.getElementById("quiz");
  form.innerHTML="";
  statements.forEach((t,i)=>{
    const q=document.createElement("div");
    q.className="q";
    q.innerHTML=`
      <p><b>${i+1}.</b> ${t}</p>
      <div class="opt">
        ${labels.map((lab,j)=>`
          <label>
            <input type="radio" name="q${i}" value="${j}">
            <span>${lab}</span>
          </label>
        `).join("")}
      </div>
    `;
    form.appendChild(q);
  });
}
document.addEventListener("DOMContentLoaded",()=>{
  renderQuestions();
  const url=window.location.href;
  document.getElementById("shareUrl").value=url;
  new QRCode(document.getElementById("qrcode"),{text:url,width:150,height:150});
});

document.getElementById("downloadQR").onclick=()=>{
  const canvas=document.querySelector("#qrcode canvas");
  const link=document.createElement("a");
  link.href=canvas.toDataURL("image/png");
  link.download="QRCode.png";
  link.click();
};

function compute(){
  let tot=0; let answers=[];
  for(let i=0;i<statements.length;i++){
    const sel=document.querySelector(`input[name="q${i}"]:checked`);
    if(!sel) return null;
    const selVal=parseInt(sel.value,10);
    const sc=scoring[i][selVal];
    tot+=sc;
    answers.push({index:i, q:statements[i], opt:labels[selVal], score:sc});
  }
  let cat=""; if(tot<=20) cat="F"; else if(tot<=33) cat="FG"; else if(tot<=44) cat="GF"; else cat="G";
  return {total:tot,category:cat,answers};
}

function showResult(r){
  const res=document.getElementById("result");
  res.style.display="block";
  const labelsFull={F:"F - Fixed Mindset",FG:"FG - Fixed → Growth",GF:"GF - Growth → Fixed",G:"G - Growth Mindset"};
  res.innerHTML=`<span class="score">${r.total}</span> <span class="badge ${r.category}">${labelsFull[r.category]}</span>`;
}

/* ================== ANALISIS CETAK ================== */
const analisisPerSoal = [
  [
    "Anda memandang kemampuan sebagai hal yang statis. Tindak lanjut: uji keyakinan ini dengan proyek kecil yang menantang dan catat peningkatannya.",
    "Anda ragu kemampuan dapat berubah. Tindak lanjut: tetapkan target mingguan dan refleksikan proses belajar.",
    "Anda mulai melihat peluang perubahan. Tindak lanjut: minta umpan balik spesifik dan perbanyak latihan bertahap.",
    "Anda yakin kemampuan bisa berkembang. Tindak lanjut: teruskan tujuan menantang dan evaluasi kemajuan rutin."
  ],
  [
    "Anda menolak kemungkinan perubahan kecil. Tindak lanjut: dokumentasikan kemajuan harian untuk melihat bukti.",
    "Perubahan mungkin namun terasa terbatas. Tindak lanjut: perluas zona nyaman dengan metode baru.",
    "Perubahan realistis. Tindak lanjut: konsisten dan ukur dampak kebiasaan belajar.",
    "Semua orang dapat berkembang. Tindak lanjut: jadikan rencana belajar kebiasaan jangka panjang."
  ],
  [
    "Anda menilai kemampuan tidak dapat diubah. Tindak lanjut: eksperimen 14 hari pada satu keterampilan.",
    "Masih setengah hati. Tindak lanjut: cari mentor/partner belajar.",
    "Cukup yakin kemampuan bisa tumbuh. Tindak lanjut: naikkan tantangan bertahap.",
    "Yakin kemampuan bisa ditingkatkan. Tindak lanjut: tetapkan sasaran ambisius & ukur progres."
  ],
  [
    "Anda merasa diri 'tetap'. Tindak lanjut: ubah 3 kebiasaan kecil bulan ini.",
    "Sebagian diri bisa berubah. Tindak lanjut: latih satu sifat melalui rutinitas.",
    "Identitas berkembang. Tindak lanjut: refleksi mingguan untuk melacak perubahan.",
    "Keunikan = titik awal tumbuh. Tindak lanjut: proyek yang menonjolkan kekuatan baru."
  ],
  [
    "Ragu dapat mengubah diri. Tindak lanjut: mulai perubahan mikro 5–10 menit/hari.",
    "Perubahan mungkin namun belum konsisten. Tindak lanjut: pasang pengingat kebiasaan.",
    "Siap berubah. Tindak lanjut: minta akuntabilitas dari rekan.",
    "Selalu dapat diperbarui. Tindak lanjut: evaluasi bulanan dan setel strategi."
  ],
  [
    "Seni hanya untuk berbakat. Tindak lanjut: latihan dasar 10 m/hari selama 30 hari.",
    "Ragu semua bisa belajar seni. Tindak lanjut: kursus pemula + catat progres.",
    "Seni dapat dipelajari. Tindak lanjut: buat portofolio kecil.",
    "Seni-musik bisa dilatih. Tindak lanjut: kurikulum latihan & target karya/bulan."
  ],
  [
    "Fokus pada bakat bawaan. Tindak lanjut: volume latihan & teknik dasar.",
    "Bakat penting, latihan kurang. Tindak lanjut: jurnal latihan.",
    "Seimbang bakat–latihan. Tindak lanjut: tingkatkan intensitas terukur.",
    "Latihan > bakat pasif. Tindak lanjut: prinsip progresif overload yang aman."
  ],
  [
    "Setuju stereotipe matematika. Tindak lanjut: latihan bertahap + lingkungan positif.",
    "Sedikit terpengaruh stereotipe. Tindak lanjut: ganti narasi diri dengan ‘saya sedang belajar’.",
    "Menolak stereotipe. Tindak lanjut: sumber belajar adaptif.",
    "Semua bisa matematika. Tindak lanjut: rutinitas singkat namun sering."
  ],
  [
    "Meremehkan peran usaha. Tindak lanjut: pomodoro 25 menit konsisten.",
    "Usaha penting namun belum konsisten. Tindak lanjut: jadwal + indikator proses.",
    "Usaha ↗ kemahiran. Tindak lanjut: ukur jam latihan & feedback.",
    "Kerja keras menaikkan keahlian. Tindak lanjut: siklus latihan–review–perbaikan."
  ],
  [
    "Tipe diri tetap. Tindak lanjut: ubah satu perilaku 21 hari.",
    "Perubahan kecil mungkin. Tindak lanjut: cari role model.",
    "Tipe diri lentur. Tindak lanjut: refleksi berbasis data.",
    "Tipe diri berkembang. Tindak lanjut: eksperimen perilaku baru rutin."
  ],
  [
    "Menghindari hal baru. Tindak lanjut: tantangan kecil mingguan.",
    "Ragu tapi bersedia coba. Tindak lanjut: target aman meningkat perlahan.",
    "Cukup nyaman dengan kebaruan. Tindak lanjut: evaluasi risiko–mitigasi.",
    "Menyambut kebaruan. Tindak lanjut: proyek eksplorasi tiap kuartal."
  ],
  [
    "Kualitas orang dianggap tetap. Tindak lanjut: cari contoh perubahan orang.",
    "Sebagian bisa berubah. Tindak lanjut: diskusikan kisah transformasi.",
    "Kualitas berkembang lewat pengalaman. Tindak lanjut: beri ruang bertumbuh.",
    "Perubahan sifat mungkin. Tindak lanjut: budaya umpan balik yang aman."
  ],
  [
    "Belum nyaman dengan kritik. Tindak lanjut: minta contoh konkret.",
    "Menerima kritik terbatas. Tindak lanjut: terima–cerna–tindak.",
    "Cukup terbuka. Tindak lanjut: eksekusi minimal satu saran/siklus.",
    "Sangat menghargai kritik. Tindak lanjut: review rutin dengan mentor."
  ],
  [
    "Menolak kritik. Tindak lanjut: minta satu masukan spesifik/minggu.",
    "Kurang nyaman tapi mencoba. Tindak lanjut: rencana aksi singkat.",
    "Menempatkan kritik sebagai data. Tindak lanjut: uji saran & evaluasi.",
    "Kelola kritik dewasa. Tindak lanjut: ajarkan praktik feedback sehat."
  ],
  [
    "Kemampuan belajar berbeda & tetap. Tindak lanjut: diferensiasi strategi.",
    "Variasi besar tapi bisa dikejar. Tindak lanjut: fokus pada proses.",
    "Semua dapat belajar dengan dukungan. Tindak lanjut: scaffolding adaptif.",
    "Kesetaraan peluang belajar. Tindak lanjut: lingkungan inklusif."
  ],
  [
    "Belajar ≠ perubahan kemampuan. Tindak lanjut: catat dampak belajar.",
    "Belajar berguna, ragu ubah kapasitas. Tindak lanjut: uji teknik baru.",
    "Belajar mengubah cara kerja. Tindak lanjut: eksperimen kecil.",
    "Belajar mengubah kemampuan. Tindak lanjut: kurva kemajuan."
  ],
  [
    "Cara baru tak ubah kemampuan. Tindak lanjut: bandingkan sebelum–sesudah.",
    "Ragu dampak signifikan. Tindak lanjut: A/B test sederhana.",
    "Cara baru memperluas kapasitas. Tindak lanjut: dokumentasikan & standarisasi.",
    "Variasi strategi memperkuat kemampuan. Tindak lanjut: continuous improvement."
  ],
  [
    "Keputusan buruk dilihat sebagai sifat tetap. Tindak lanjut: empati & analisis sebab–akibat.",
    "Akui faktor situasi tapi masih menilai tetap. Tindak lanjut: belajar dari kesalahan.",
    "Perilaku dapat diperbaiki. Tindak lanjut: ruang aman untuk koreksi.",
    "Setiap orang bisa bertumbuh. Tindak lanjut: refleksi & komitmen perbaikan."
  ],
  [
    "Motivasi hal baru rendah. Tindak lanjut: hubungkan tugas dengan nilai pribadi.",
    "Motivasi cukup tapi fluktuatif. Tindak lanjut: target mikro menantang.",
    "Motivasi baik & stabil. Tindak lanjut: tonggak capaian & rayakan.",
    "Motivasi sangat tinggi. Tindak lanjut: jaga keseimbangan & roadmap."
  ],
  [
    "Percaya ‘cerdas’ > kerja keras. Tindak lanjut: lihat bukti dampak usaha.",
    "Nilai kerja keras namun sering abai. Tindak lanjut: jadwal latihan fokus harian.",
    "Padukan kecerdasan & ketekunan. Tindak lanjut: feedback ahli.",
    "Kerja keras = pengungkit utama. Tindak lanjut: ritme & evaluasi berkelanjutan."
  ]
];

function getAnalisisPerButir(a){
  const arr = analisisPerSoal[a.index];
  if(!arr) return "Analisis tidak tersedia.";
  return arr[a.score] ?? "Analisis tidak tersedia.";
}

function showAnalysis(r){
  let newWin=window.open("","_blank");
  let html=`<html><head><title>Analisis</title>
  <style>
    body{font-family:Arial,sans-serif; padding:15px; line-height:1.35;}
    h2{text-align:center;color:#2563eb;margin-bottom:10px;}
    .header-table{width:100%; border-collapse:collapse; margin-bottom:8px;}
    .header-table td{font-size:13px; padding:4px 6px; vertical-align:top;}
    .header-table .label{text-align:right; font-weight:bold; width:120px;}
    table{width:100%; border-collapse:collapse; font-size:13px;}
    th,td{padding:6px 8px; border-bottom:1px solid #ddd; text-align:left; vertical-align:top;}
    tr:nth-child(even){background:#f9f9f9;} tr:hover{background:#eef6ff;}
    th{background:#2563eb;color:white;}
    .btn-print{margin-top:10px; display:block; padding:10px 14px; background:#2563eb; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:bold;}
    @media print{.btn-print{display:none;} body{margin:0;} @page{margin:1.5cm; size:A4;}}
  </style>
  </head><body>
  <h2>Analisis Pemetaan Profil Pola Pikir</h2>
  <table class="header-table">
    <tr>
      <td class="label">Nama</td><td>: ${document.getElementById("nama").value || "-"}</td>
      <td style="font-weight:bold;">Total:</td><td>${r.total}</td>
      <td style="font-weight:bold;">Kategori:</td><td>${r.category}</td>
    </tr>
    <tr>
      <td class="label">Instansi</td><td>: ${document.getElementById("instansi").value || "-"}</td>
      <td style="font-weight:bold;">Interpretasi:</td>
      <td colspan="3">${
        r.category=="G"?"Growth Mindset sangat baik—Anda konsisten melihat tantangan sebagai peluang belajar.":
        r.category=="GF"?"Cenderung Growth—dasar positif sudah ada, tinggal memperkuat konsistensi di area tertentu.":
        r.category=="FG"?"Cenderung Fixed—namun mulai terbuka; fokuskan pada pengalaman belajar yang terstruktur.":
        "Fixed Mindset dominan—perlu perubahan cara pandang terhadap usaha, proses, dan umpan balik."
      }</td>
    </tr>
    <tr>
      <td class="label">Bidang/Mapel</td><td>: ${document.getElementById("mapel").value || "-"}</td>
      <td style="font-weight:bold;">Motivasi:</td>
      <td colspan="3">Kemampuan berkembang lewat proses: tetapkan target jelas, latihan konsisten, dan rayakan progres kecil.</td>
    </tr>
  </table>
  <table>
    <tr><th>Pernyataan</th><th>Jawaban</th><th>Analisis & Tindak Lanjut</th></tr>`;
  r.answers.forEach(a=>{
    html+=`<tr><td>${a.q}</td><td>${a.opt}</td><td>${getAnalisisPerButir(a)}</td></tr>`;
  });
  html+=`</table>
  <button class="btn-print" onclick="window.print()">Cetak / Simpan PDF</button>
  </body></html>`;
  newWin.document.write(html);
  newWin.document.close();
}

/* ================== SUBMIT → GOOGLE SHEET ================== */
function buildPayload(){
  const nama = (document.getElementById("nama").value || "").trim();
  const instansi = (document.getElementById("instansi").value || "").trim();
  const mapel = (document.getElementById("mapel").value || "").trim();

  const r = compute();
  if(!r){ return {ok:false, message:"Lengkapi semua 20 pertanyaan terlebih dahulu."}; }

  // kolom yang dikirim ke server (timestamp akan dibuat di Apps Script)
  const payload = {
    nama, instansi, mapel,
    skor: r.total,
    kategori: r.category,
    jawaban: r.answers   // server akan simpan sebagai JSON string
  };
  return {ok:true, data:payload, result:r};
}

async function submitToSheet(){
  const submitBtn = document.getElementById("submitBtn");
  const pack = buildPayload();
  if(!pack.ok) { alert(pack.message); return; }

  try{
    submitBtn.disabled = true;
    const oldText = submitBtn.textContent;
    submitBtn.textContent = "MENGIRIM...";

    // Hindari preflight (OPTIONS) → gunakan x-www-form-urlencoded (simple request)
    const body = new URLSearchParams({ payload: JSON.stringify(pack.data) });

    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
      body
    });

    // Jika server mengembalikan JSON, coba baca. Jika tidak, tetap anggap sukses jika status 200.
    let ok = res.ok;
    let msg = "Terkirim. Terima kasih!";
    try {
      const t = await res.text();
      if (t) {
        const j = JSON.parse(t);
        ok = j.status === "ok";
        msg = j.message || msg;
      }
    } catch(_) {}

    if(ok){
      showResult(pack.result);
      alert(msg);
    } else {
      alert("Gagal mengirim. Coba lagi atau hubungi admin.");
    }
    submitBtn.textContent = oldText;
    submitBtn.disabled = false;
  } catch(err){
    submitBtn.disabled = false;
    submitBtn.textContent = "SUBMIT";
    alert("Terjadi kesalahan jaringan: " + err.message);
  }
}

/* ================== HOOK BUTTONS ================== */
document.getElementById("submitBtn").onclick = submitToSheet;
document.getElementById("analisisBtn").onclick = ()=>{
  const r=compute(); if(!r){alert("Lengkapi semua pertanyaan!"); return;} showAnalysis(r);
};
document.getElementById("resetBtn").onclick = ()=>{ location.reload(); };
</script>
</body>
</html>
